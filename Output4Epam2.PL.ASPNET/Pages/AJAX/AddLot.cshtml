@using Output4Epam.Entities
@using Output4Epam.Providers

@{
	bool isUser = LogicProvider.RegUserLogic.IsUserInRole(User.Identity.Name, RoleScroll.User.ToString());
}
@{
	if (isUser)
	{

		if (IsPost)
		{
			try
			{

				string title = Request["Title"];
				string sity = Request["Sity"];
				int cost = Int32.Parse(Request["Cost"]);
				string info = Request["Info"];
				int type = Int32.Parse(Request["Types"]);
				Guid lotId = Guid.NewGuid();
				Stream photo = Request.Files["Photo"] == null ? default(Stream) : Request.Files["Photo"].InputStream;

				LogicProvider.LotLogic.Add(new Lot(title,
									User.Identity.Name,
									sity,
									cost,
									info,
									(LotTypes)type,
									DateTime.Now,
									lotId));

				if (photo != default(Stream))
				{
					LogicProvider.LotLogic.AddImage(lotId, photo);
				}
			}
			catch (NotImplementedException)
			{
				Response.Redirect("/Pages/ErrorPages/501.cshtml");
			}
			catch (ArgumentException)
			{
				Response.Redirect("/Pages/ErrorPages/400.cshtml");
			}
			catch
			{
				Response.Redirect("/Pages/ErrorPages/Other.cshtml");
			}
		}
	}

	Response.Redirect("/Pages/StructureElements/Index.cshtml");
	return;
}